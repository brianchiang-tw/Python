# For image output to bmp file
import os

# For image operation
from library.image_tool_box import * 

# For math/statistic operation
from library.math_tool_box import StatMaker
import math


###     Prelude: Downlaod and unpack those 4 test data from MNIST database.

# train-images-idx3-ubyte.gz: training set images (9912422 bytes)
# train-labels-idx1-ubyte.gz: training set labels (28881 bytes)
# t10k-images-idx3-ubyte.gz: test set images (1648877 bytes)
# t10k-labels-idx1-ubyte.gz: test set labels (4542 bytes) 

# MNIST database
# http://yann.lecun.com/exdb/mnist/

# This is is completed, and they're saved in sub-directory "./data_of_mAiLab003"

file_name_of_MNIST_image = 'train-images.idx3-ubyte'
file_name_of_MNIST_label = 'train-labels.idx1-ubyte'
data_directory_path = 'data_of_mAiLab003/'
ouput_directory_path = './output_of_mAiLab004/'
path_of_MNIST_image = data_directory_path + file_name_of_MNIST_image
path_of_MNIST_label = data_directory_path + file_name_of_MNIST_label


kernel_Gx = [   [-1, 0, +1],
                [-2, 0, +2],
                [-1, 0, +1]
            ]

kernel_Gy = [   [+1, +2, +1],
                [ 0,  0,  0],
                [-1, -2, -1]
            ]


kernel_Gx_5 =   [   [ -5,  -4, 0,  +4,  +5],
                    [ -8, -10, 0, +10,  +8],
                    [-10, -20, 0, +20, +10],
                    [ -8, -10, 0, +10,  +8],
                    [ -5,  -4, 0,  +4,  +5]                                                
                ]

kernel_Gy_5 = array_transpose( kernel_Gx_5 )
kernel_Gy_5 = array_with_negation( kernel_Gy_5 )



kernel_Gx_7 =   [   [ -130,  -120,  -78, 0,  +78, +120, +130],
                    [ -180,  -195, -156, 0, +156, +195, +180],
                    [ -234,  -312, -390, 0, +390, +312, +234],
                    [ -260,  -390, -780, 0, +780, +390, +260],
                    [ -234,  -312, -390, 0, +390, +312, +234],
                    [ -180,  -195, -156, 0, +156, +195, +180],
                    [ -130,  -120,  -78, 0,  +78, +120, +130]                                                
                ]

kernel_Gy_7 = array_transpose( kernel_Gx_7 )
kernel_Gy_7 = array_with_negation( kernel_Gy_7 )



kernel_Gx_9 =   [   [ -16575,  -15912,  -13260,   -7800,       0,    7800,   13260,   15912,   16575],
                    [ -21216,  -22100,  -20400,  -13260,       0,   13260,   20400,   22100,   21216],
                    [ -26520,  -30600,  -33150,  -26520,       0,   26520,   33150,   30600,   26520],
                    [ -31200,  -39780,  -53040,  -66300,       0,   66300,   53040,   39780,   31200],
                    [ -33150,  -44200,  -66300, -132600,       0,  132600,   66300,   44200,   33150],
                    [ -31200,  -39780,  -53040,  -66300,       0,   66300,   53040,   39780,   31200],
                    [ -26520,  -30600,  -33150,  -26520,       0,   26520,   33150,   30600,   26520],
                    [ -21216,  -22100,  -20400,  -13260,       0,   13260,   20400,   22100,   21216],
                    [ -16575,  -15912,  -13260,   -7800,       0,    7800,   13260,   15912,   16575]
                ]


kernel_Gy_9 = array_transpose( kernel_Gx_9 )
kernel_Gy_9 = array_with_negation( kernel_Gy_9 )


# Create output directory for edge image
if not os.path.isdir(ouput_directory_path):
    os.mkdir(ouput_directory_path)


with open(path_of_MNIST_image, 'rb') as file_handle:

    # Read header of MNIST image file
    header_return = get_MNIST_image_header(file_handle)

    if -1 == header_return:
        # Handle End-of-File, or exception
        pass

    else:
        (img_height, img_width) = header_return

        image_container = []
        grad_magnitude_container = []
        edge_img_container = []

        for index in range(5):

            image_return = read_one_MNIST_image(file_handle, img_height, img_width)

            if -2 == image_return:
                # Handle exception
                print("Error occurs in index {:0>2d}".format( index ) )
                break

            else:
                image_matrix = image_return

                    # Push origianl source image into image container
                image_container.append(image_matrix)



                    # Convolve image_matrix with kernel Gx
                Gx_conv_image = img_conv_kernel( image_matrix, kernel_Gx )

                    # Convolve image_matrix with kernel Gy
                Gy_conv_image = img_conv_kernel( image_matrix, kernel_Gy )
        
                    # Compute gradient magnitude from Gx_conv_image and Gy_conv_image
                gradient_magnitude_image = get_Sobel_gradient_magnitude(Gx_conv_image, Gy_conv_image)



                    # Push Gx image, Gy image, and gradient magnitude image into its container
                grad_magnitude_container.append( (Gx_conv_image, Gy_conv_image, gradient_magnitude_image ) )

                    # Compute edge image from gradient magnitude
                edge_image = get_edge_image( gradient_magnitude_image, threshold_factor=0.7 )

                    # Push edge image into its container
                edge_img_container.append( edge_image )



###     1. Output Gx, Gy convolution image for first 5 input image, with extended image size 30 x 30 and zero padding.

for index in range(5):

    serial_number = index+1

        # Source image
    # print("Original source image array_#{}:".format(serial_number) )
    # print_image_array( image_container[index] )

        # Gx edge image
    gx = grad_magnitude_container[index][0]
    gx_abs_image = absolute_value_tranform_of_partial_differential_img( gx )
    gx_edge = get_edge_image( gx_abs_image, 0.1 )

    save_to_bmp(gx_edge, ouput_directory_path+"image_"+ str(serial_number)+"_Gx_edge")


        # Gy edge image
    gy = grad_magnitude_container[index][1]
    gy_abs_image = absolute_value_tranform_of_partial_differential_img( gy )
    gy_edge = get_edge_image( gy_abs_image, 0.1 )

    save_to_bmp(gy_edge, ouput_directory_path+"image_"+ str(serial_number)+"_Gy_edge")

        # Edge image
    edge_image = edge_img_container[index]

    # print("Edge image_#{}:".format(serial_number) )
    # print_image_array( edge_image, "Decimal" )

    save_to_bmp(edge_image, ouput_directory_path+"image_"+str(serial_number)+"_edge")



###     2. Output the result, which is first input source image convolutes with Sobel filter kernel of size 5x5, 7x7,and 9x9.

    # Convolve image_matrix with kernel Gx_5x5
Gx_conv_image = img_conv_kernel( image_container[0], kernel_Gx_5 )
print(" 5x5 Gx convolution image of image_#1")
print_image_array( Gx_conv_image, "Decimal" )

    # Convolve image_matrix with kernel Gy_5x5
Gy_conv_image = img_conv_kernel( image_container[0], kernel_Gy_5 )
print(" 5x5 Gy convolution image of image_#1")
print_image_array( Gy_conv_image, "Decimal" )



    # Convolve image_matrix with kernel Gx_7x7
Gx_conv_image = img_conv_kernel( image_container[0], kernel_Gx_7 )
print(" 7x7 Gx convolution image of image_#1")
print_image_array( Gx_conv_image, "Decimal" )

    # Convolve image_matrix with kernel Gy_7x7
Gy_conv_image = img_conv_kernel( image_container[0], kernel_Gy_7 )
print(" 7x7 Gy convolution image of image_#1")
print_image_array( Gy_conv_image, "Decimal" )



    # Convolve image_matrix with kernel Gx_9x9
Gx_conv_image = img_conv_kernel( image_container[0], kernel_Gx_9 )
print(" 9x9 Gx convolution image of image_#1")
print_image_array( Gx_conv_image, "Decimal" )

    # Convolve image_matrix with kernel Gy_9x9
Gy_conv_image = img_conv_kernel( image_container[0], kernel_Gy_9 )
print(" 9x9 Gy convolution image of image_#1")
print_image_array( Gy_conv_image, "Decimal" )




'''

Example output:

###     1. Output and save Sobel_x_gradient, Sobel_y_gradient, as well as edge image of first ten input source images.

Image is saved into './output_of_mAiLab004/image_1_Gx_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_1_Gy_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_1_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_2_Gx_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_2_Gy_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_2_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_3_Gx_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_3_Gy_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_3_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_4_Gx_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_4_Gy_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_4_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_5_Gx_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_5_Gy_edge.bmp'.
Image is saved into './output_of_mAiLab004/image_5_edge.bmp'.



###     2. Output the result, which is first input source image convolutes with Sobel filter kernel of size 5x5, 7x7,and 9x9.


 5x5 Gx convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0        -15       -102       -162       -150       -615      -1022      -1257       -236        240       -559      -1276       -829       1342       2263       1743        635          0          0 
         0          0          0          0          0          0       -150       -300       -614      -1026      -1196      -1563      -1515      -1121      -1399      -2024      -2296        -37       1104       -919      -2996       -846       4585       6500       4477       1336          0          0 
         0          0          0          0          0       -245      -1626      -2805      -3193      -2952      -2405      -2736      -2802      -2102      -1894      -3330      -2898       1363       4141       -183      -5386       -604       8658      11812       7405       1782          0          0 
         0          0          0          0          0       -482      -3861      -7505      -7929      -5913      -4074      -3864      -3619      -2369      -1500      -2144       -102       5682       7657       1563      -3274       1708       9914      11668       6788       1656          0          0 
         0          0          0          0          0       -634      -5932     -13192     -13255      -7805      -3990      -3427      -1312       1579       1349      -1269       1040       9700      11357       4117       -676       2295       7086       7489       4333       1147          0          0 
         0          0          0          0          0       -572      -5734     -13732     -14385      -8906      -5811      -4629        868       7209       6420       -306        788      10675      12556       5255        562       1858       3193       2828       1543        320          0          0 
         0          0          0          0          0       -389      -4118      -9703     -10793      -8307      -9262      -8500       2794      13949      11907       1164      -1158       6281       9427       4487        374        582        634        436        195          0          0          0 
         0          0          0          0          0        -90      -1807      -4329      -4911      -6332     -12262     -13727        969      15776      14260       3937       -332       2328       4083       2437          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0       -400      -1212      -1307      -4093     -11792     -16186      -4789      12133      15133       7179       1780       1404       1375        775          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0        -70        -61      -1996      -7639     -14451     -11539       2509      10782       8768       5717       4537       2615        703        125          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0       -783      -3801      -9644     -13219      -7947       1212       5891       8267       9271       6483       3077       1058        135          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0        -55      -1274      -5113      -9908     -11993      -8195      -1741       4851      10257      10793       7494       3733       1151          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0       -175      -1993      -5269      -8872     -10939      -9647      -4214       3961      11882      13284       8395       3267        320          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0       -405      -2114      -5157      -8522     -12531     -13190      -5618       8832      17950      14472       5761        522          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0       -195       -896      -2330      -4763      -7167     -11548     -15678     -10260       6380      19480      18334       7987        656          0          0          0          0          0 
         0          0          0          0          0          0          0          0       -120       -666      -1873      -3627      -5473      -7047      -7881      -9714     -10338      -5624       7746      19545      17407       7133        532          0          0          0          0          0 
         0          0          0          0          0          0       -115       -422      -1521      -3177      -5196      -7349      -9040      -8987      -6180      -3810      -1388       2285       9985      16463      13119       4997        336          0          0          0          0          0 
         0          0          0          0        -90       -927      -1963      -2827      -4107      -6090      -8682      -9650      -7835      -4436       -582       2650       5515       8402      11041      10379       6693       2499         10          0          0          0          0          0 
         0          0       -275      -1080      -1962      -3497      -5006      -5667      -6477      -8433      -8779      -5406      -1198       2527       5667       8160       8995       7813       6433       4673       2602        910          0          0          0          0          0          0 
         0          0      -1120      -3735      -5985      -7537      -8568      -7472      -5613      -4513      -3025        970       5947       8879       9190       7626       6047       4449       2737       1333        390          0          0          0          0          0          0          0 
         0          0      -1638      -6204     -10398     -10692      -7785      -4452      -2151       -235       2096       6589      10170       9185       6514       4413       2779       1386        413         10          0          0          0          0          0          0          0          0 
         0          0      -1800      -7176     -11208      -9531      -4933       -987       1851       3496       5380       7416       7091       5354       3183       1383        436         45          0          0          0          0          0          0          0          0          0          0 
         0          0      -1363      -4464      -6372      -5143      -1922        841       2013       2741       3522       4090       3413       1880        709         55          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0       -680      -1809      -2277      -1733       -380        754       1077       1505       1536       1203        724         80          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 


 5x5 Gy convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0         15        114        264        438       1113       2102       3457       3988       4506       4943       6018       6619       6356       4521       2251        635          0          0 
         0          0          0          0          0          0        150        420       1058       2122       3472       5199       7003       8591       9929      11524      13800      14385      14468      13513      15760      17026      15087       9440       3745        828          0          0 
         0          0          0          0          0        245       1702       4103       7397      10544      13613      15984      17966      20026      20920      21242      20324      18493      16043      13955      13464      12202       9220       4790       1615        256          0          0 
         0          0          0          0          0        286       2681       7569      14415      18839      21010      21150      20665      19815      18868      17570      13496       9210       3405        329      -4270      -7184      -7756      -5416      -2102       -508          0          0 
         0          0          0          0          0         72       1336       4538       9349      12609      13420      12369       9586       5381        615      -1953      -3810      -5626     -10435     -13409     -16898     -16883     -14328      -8719      -3671       -891          0          0 
         0          0          0          0          0       -196      -1272      -3298      -6145      -6380      -5363      -3045      -4236      -8647     -15398     -18818     -18008     -14789     -12998     -12021     -11490      -9842      -7331      -4024      -1643       -320          0          0 
         0          0          0          0          0       -317      -2638      -7165     -14019     -17231     -15952     -10852      -8356     -10837     -14701     -17838     -18244     -14971      -8667      -4719      -2584      -1938      -1248       -592       -195          0          0          0 
         0          0          0          0          0        -90      -1559      -4621      -9211     -13052     -13060     -10247      -6225      -4494      -4788      -7221      -8930      -8806      -4875      -1821          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0       -400      -1476      -2727      -5183      -7674      -8634      -4165       2621       5721       4599       2056       -210       -899       -765          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0        -70       -117      -1474      -4881      -8443      -6987       1455      10482      13742      11493       6419       2909        799        125          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0       -739      -3247      -7172      -9897      -6017       4860      13621      16567      12991       7707       3461       1066        135          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0        -55      -1178      -4209      -8192     -11451      -8391        553       9549      14505      12877       8202       3631       1043          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0       -175      -1809      -5173     -10258     -14793     -12761      -4524       7225      13406      12818       6679       2505        320          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0       -405      -1798      -4171      -7694      -9793      -7170       1588       8152      10674       6728       2579        266          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0        195       1052       2678       4515       6175       6526       5090       3366       2818       2774       1980        875          8          0          0          0          0          0 
         0          0          0          0          0          0          0          0        120        762       2413       5347       9707      14729      18113      17172      12012       2944      -2788      -5519      -4333      -1843       -256          0          0          0          0          0 
         0          0          0          0          0          0        115        514       1919       4509       8566      13595      17922      19121      16872      10716       2656      -6527     -12231     -12379      -6707      -2605       -328          0          0          0          0          0 
         0          0          0          0         90        999       2735       5365       8909      13118      17336      18832      16357      10178       2430      -5856     -13321     -17846     -17153     -12519      -5761      -1779        -10          0          0          0          0          0 
         0          0        275       1300       3128       6097      10146      15289      18581      19843      17745      11966       3590      -5485     -13569     -18512     -19487     -17035     -11827      -6669      -3018       -910          0          0          0          0          0          0 
         0          0        900       3591       8373      14169      18228      19246      17093      12101       4351      -3674     -11505     -17475     -19212     -17124     -12449      -7565      -3997      -1637       -390          0          0          0          0          0          0          0 
         0          0        544       2372       6190       9098       8451       3946      -1867      -8073     -13072     -17585     -19092     -17047     -12460      -7687      -4085      -1694       -421        -10          0          0          0          0          0          0          0          0 
         0          0       -220      -1238      -3814      -8261     -12645     -16421     -18973     -20534     -20512     -18614     -14001      -8450      -4339      -1749       -472        -45          0          0          0          0          0          0          0          0          0          0 
         0          0       -819      -3672      -9318     -15195     -18712     -19749     -18633     -16279     -13434      -9028      -5323      -2458       -753        -55          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0       -680      -2353      -4649      -6907      -8318      -8190      -7149      -5447      -3588      -1891       -788        -80          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 


 7x7 Gx convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0       -390      -2700      -4734      -5904     -19710     -32440     -44944     -29084     -24022     -27030     -29308     -25332       4312      33284      71446      72696      47350      16510          0 
         0          0          0          0          0      -3900      -8280     -18880     -34108     -46112     -62719     -68176     -64570     -67554     -71295     -77968     -36573     -23940     -25552     -36905     -25434      45903     123622     195277     173729     102255      31180          0 
         0          0          0          0      -6370     -42220     -77602    -110434    -130828    -129856    -124716    -107259    -102357    -101823    -103945    -108044     -35250      19155      48890      -1637     -39580      73740     240727     358306     289793     150072      41238          0 
         0          0          0          0     -11160     -90045    -177952    -257263    -287683    -264970    -229027    -163536    -148906    -138354    -124214    -128152     -13320     112303     210011      74525     -86978      91334     399430     577790     421803     186368      47996          0 
         0          0          0          0     -14706    -132110    -294561    -460747    -511911    -445607    -373890    -220916    -153449    -104579     -59376     -18670     116722     267404     342055     166329      45694     187824     456638     578864     400426     182208      46358          0 
         0          0          0          0     -16952    -159272    -394654    -682536    -744735    -566685    -415962    -204417     -53560      52963      83513      96711     210336     444432     496645     273533     168856     197835     342602     402473     286075     144963      37836          0 
         0          0          0          0     -16146    -159060    -394112    -702668    -818709    -657618    -513777    -250103      42154     285795     317844     197030     211132     486631     558052     310435     188036     139036     207959     246466     189537     104056      28030          0 
         0          0          0          0     -13032    -133957    -317460    -530093    -688043    -670829    -676930    -426944      87128     533945     575471     357290     208560     346295     453449     289167     178910      86172     106090     108904      77537      40050       8320          0 
         0          0          0          0      -9610     -98470    -221429    -321483    -449979    -573962    -745738    -591345      24117     583520     653700     480983     306280     254178     285147     215803     120684      25284      24868      20422      11960       5070          0          0 
         0          0          0          0      -2340     -45030    -107530    -147094    -252843    -444651    -714990    -714424    -236393     397121     631149     522947     378192     260326     227055     167555      77700       3250          0          0          0          0          0          0 
         0          0          0          0          0     -10400     -32400     -41780    -123383    -305532    -550311    -692255    -524517      26055     438252     470214     414999     329209     274305     197249      99545      27240       3510          0          0          0          0          0 
         0          0          0          0          0          0      -1820      -1810     -48826    -181085    -376235    -544392    -644971    -418421      13448     269305     431191     468069     405429     314889     192614      93445      29170          0          0          0          0          0 
         0          0          0          0          0          0          0          0     -20050     -94105    -238582    -380381    -540254    -598463    -422481    -119573     214993     480529     562871     503882     363475     199791      80028       8320          0          0          0          0 
         0          0          0          0          0          0          0          0      -1430     -32320    -125707    -246347    -395293    -544490    -645241    -532941    -217664     251439     645712     757988     604395     334891     135228      11780          0          0          0          0 
         0          0          0          0          0          0          0          0          0      -9620     -74030    -189277    -337582    -489115    -651638    -698257    -586502     -77030     563698     958822     891572     489141     194482      15336          0          0          0          0 
         0          0          0          0          0          0          0      -3120     -17700     -51302    -113077    -214564    -343274    -472337    -627899    -683530    -674630    -200920     513464    1027598    1042976     581067     220140      17108          0          0          0          0 
         0          0          0          0          0      -2990     -11340     -41724     -88798    -152950    -228295    -313849    -406409    -474535    -571825    -562660    -454142     -27814     551300    1017037     996917     543989     212592      15496          0          0          0          0 
         0          0          0      -2340     -24390     -54534     -88873    -139342    -199021    -274339    -353066    -432487    -476798    -427267    -353410    -237044     -88914     230653     599937     886505     806543     438207     177992      11988          0          0          0          0 
         0      -7150     -28960     -57550    -107716    -157543    -200509    -249441    -307155    -392428    -455970    -461506    -359491    -175714     -29618     106198     249229     470632     619253     626279     500649     289543     120288       8680          0          0          0          0 
         0     -27580     -90895    -160870    -245056    -306195    -343806    -358973    -362687    -424081    -388447    -244914     -70930     114591     260587     388708     455933     480649     451423     381777     273968     156628      59910        260          0          0          0          0 
         0     -37350    -129468    -248769    -382617    -453627    -498878    -456962    -338597    -273857    -150709      21400     230533     406621     460480     437356     386909     337577     269743     199231     128944      68380      23660          0          0          0          0          0 
         0     -46124    -167804    -364130    -570518    -587762    -472067    -324834    -169593     -70595      84408     284869     456124     488899     410462     336259     260357     195214     132781      78064      35850      10140          0          0          0          0          0          0 
         0     -48230    -176228    -401768    -592874    -528441    -343569    -166729       7823     103516     252832     373106     392811     371628     288493     207025     133216      79123      37236      10770        260          0          0          0          0          0          0          0 
         0     -41724    -143319    -276318    -377640    -346119    -224596     -80833      53519     139799     232920     279688     267241     225412     153073      88615      37632      11480       1170          0          0          0          0          0          0          0          0          0 
         0     -31630    -101020    -170401    -207769    -182335    -102088      -7440      72063     117405     152006     156367     133960      99424      51418      18610       1430          0          0          0          0          0          0          0          0          0          0          0 
         0     -17680     -49210     -73858     -82984     -67046     -26670      17878      54534      67570      67612      54056      34638      19080       2080          0          0          0          0          0          0          0          0          0          0          0          0          0 


 7x7 Gy convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0          0        390       2880       6282      10572      29214      54004      89236     109256     137634     171458     205424     219064     213232     186868     158298     107328      54970      16510          0 
         0          0          0          0          0       3900      10080      25720      53164      88556     140535     197232     251924     315334     372961     429952     465577     497524     521874     541449     545728     518623     441208     334959     199925      91275      23560          0 
         0          0          0          0       6370      43360      97366     174522     270720     371316     478996     577219     650245     727561     787463     830604     882178     886161     847518     765351     783196     774388     659725     441334     209285      80028      17586          0 
         0          0          0          0       8220      72165     176068     332065     529639     712734     891255    1033844    1105850    1183414    1215596    1174028    1097718     979853     825881     689719     611272     504588     382836     216384      88581      29874       4992          0 
         0          0          0          0       5982      66398     189333     405995     721733     947329    1084178    1138614    1110671    1042541     980856     838840     655248     446260     201219      69463    -118526    -286572    -298116    -217776     -97500     -36036      -9906          0 
         0          0          0          0       1404      27150      89570     204874     426169     592709     644036     619799     526678     335125     149911     -29153    -130986    -264198    -464139    -578229    -678030    -696987    -575328    -379695    -192645     -79599     -20232          0 
         0          0          0          0      -3822     -23568     -59814    -151170    -221585    -181340    -136397     -60395     -92950    -301645    -583862    -779874    -836848    -800137    -761882    -747425    -712780    -631324    -499813    -351990    -204813     -93892     -24190          0 
         0          0          0          0      -7284     -61905    -161964    -355171    -619877    -733525    -717812    -603100    -535134    -676817    -843861    -946836   -1021614    -950085    -702669    -542259    -429160    -326224    -248716    -171648     -95861     -41550      -8320          0 
         0          0          0          0      -8530     -75790    -190525    -365787    -608139    -779962    -786864    -706489    -521393    -421670    -428176    -441431    -501402    -525988    -374063    -245283    -150804     -69724     -48664     -29866     -14300      -5070          0          0 
         0          0          0          0      -2340     -41310    -111934    -204838    -346651    -491109    -576096    -598880    -389917     -61863      57321      95419      76544      16724     -27599     -37365     -29720       3250          0          0          0          0          0          0 
         0          0          0          0          0     -10400     -36360     -63560    -143339    -267598    -397577    -504063    -413525      -7807     370468     564560     582395     449275     286755     157185      65421      27360       3510          0          0          0          0          0 
         0          0          0          0          0          0      -1820      -2650     -41014    -138485    -259661    -379484    -466725    -280051     178268     561071     758179     708093     529953     350345     203274      91765      27550          0          0          0          0          0 
         0          0          0          0          0          0          0          0     -19390     -85585    -197866    -316393    -458666    -558209    -354893      48249     458915     720077     699983     526086     344321     175423      68436       8320          0          0          0          0 
         0          0          0          0          0          0          0          0      -1430     -30880    -111727    -212251    -338029    -496148    -541615    -374539       5234     469339     708768     657282     428003     216457      84216       7940          0          0          0          0 
         0          0          0          0          0          0          0          0          0        520     -21090     -57869    -107302    -177521    -223678    -225847     -71474     248344     493406     558182     398508     201235      76190       5232          0          0          0          0 
         0          0          0          0          0          0          0       3120      19140      59546     120421     186316     252418     306221     349791     355576     289858     192510     159802     142368      97498      53015      20472        156          0          0          0          0 
         0          0          0          0          0       2990      12720      47832     111014     210094     348607     519029     696851     842929     845209     703330     421880      41778    -194010    -285967    -240743    -117471     -41160      -4992          0          0          0          0 
         0          0          0       2340      25470      66222     129409     225826     351919     511227     700892     883165    1002764     982033     757286     406390      -7234    -386887    -629811    -632873    -417327    -212155     -83128      -7836          0          0          0          0 
         0       7150      32260      75370     152148     255939     388713     550615     722029     881128    1014092    1002648     827301     519332     120790    -289632    -661711    -867364    -881609    -707355    -427433    -211927     -83316      -8560          0          0          0          0 
         0      24280      88735     189478     338682     515131     710162     930363    1035603    1013083     855493     554070     160586    -253701    -641237    -910092   -1020729    -940043    -734265    -493005    -291128    -142192     -49110       -260          0          0          0          0 
         0      20610      78876     188037     376641     595971     741678     787284     697941     478977     144287    -215536    -582595    -881745   -1024830   -1001394    -848051    -636681    -446907    -284771    -159964     -74620     -23660          0          0          0          0          0 
         0      10608      40950     110838     247806     351516     312465     126384    -121065    -401477    -654568    -891121   -1012262    -988317    -845480    -654661    -469371    -310810    -186625     -97432     -40410     -10140          0          0          0          0          0          0 
         0      -4290     -21996     -68070    -189000    -371183    -555969    -739755    -895409   -1012162   -1077076   -1049684    -899597    -683228    -483197    -317371    -188956     -99359     -41868     -10890       -260          0          0          0          0          0          0          0 
         0     -17208     -72315    -192402    -438966    -702963    -887662   -1006423   -1035415    -985473    -892064    -702682    -513099    -345190    -206861    -107155     -43176     -12020      -1170          0          0          0          0          0          0          0          0          0 
         0     -23470     -89140    -195337    -339789    -483717    -587142    -645976    -635575    -563107    -456170    -333363    -219612    -129752     -60154     -19270      -1430          0          0          0          0          0          0          0          0          0          0          0 
         0     -17680     -57370    -110254    -172992    -229906    -264374    -279270    -250182    -196906    -140704     -86908     -45054     -20040      -2080          0          0          0          0          0          0          0          0          0          0          0          0          0 


 9x9 Gx convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0     -49725    -346086    -624546    -846846   -2753946   -4614792   -6695637   -5574894   -5831241   -6771531   -7239219   -5239767    -509262    3067740    6513897    8380242   11074830    9840909    6114849    2105025 
         0          0          0          0    -497250   -1074060   -2528682   -4759638   -6859086   -9887943  -11836899  -12398739  -13706565  -14322999  -14074793   -9365606   -8118061   -7637147   -7685382   -3311873    5419419   13276571   20580499   24303992   27009255   21422210   12297545    3755232 
         0          0          0    -812175   -5361018  -10057047  -15159195  -19907255  -22649831  -24725299  -24145661  -21054908  -19298213  -19661622  -16856622   -8919203   -4608621    -619977    1080982    5115437   13491615   23840739   34800719   41246456   42071260   30828990   16634585    4725864 
         0          0          0   -1337934  -10844249  -21416651  -32316419  -41507699  -45617399  -46314839  -41312538  -32217402  -26169138  -25600686  -18192431   -8031973     733167   12017193   18577738   16843412   17208625   32808351   54323678   68024372   62893282   41074176   20715684    5659680 
         0          0          0   -1681368  -15117264  -32366718  -50578445  -69205337  -77241599  -76601399  -64830083  -45871536  -32697461  -28197450  -13661569   -4660901    6045213   26078555   41749873   28249828   12397325   42250906   83190710  106627240   87277650   49171330   23465650    6206850 
         0          0          0   -2006160  -18425280  -41797006  -70304085 -106157000 -119491161 -111221506  -91766646  -60191710  -37100320  -24528706     598905   20602294   35043653   57125920   65088386   43860720   35442458   62050014   93448810  107478280   84196970   48700860   23268310    6084000 
         0          0          0   -2185950  -20661940  -48914134  -89163386 -149397219 -166751511 -137352126 -101436180  -59525874  -20218250    3218294   28574014   47593485   61727493   94562664   93762740   63572080   57174350   65056200   72986290   77194630   63646970   40813110   20359410    5364840 
         0          0          0   -2125500  -20721870  -49513950  -89137390 -154927219 -183328218 -155343513 -117067656  -67360978   -4478596   41920674   68258262   68221363   72029216  110645303  106334918   69400586   58772146   53856206   47934430   49570676   45011106   31264640   16393652    4391712 
         0          0          0   -1861080  -18648480  -43747826  -74143914 -125097640 -162828190 -158919517 -143888531  -99022714   -1917524   77143855  103718095   88974364   75951318   95999008   92548504   64700163   52920508   42382023   31789157   32717714   31798408   23268801   12700649    3462849 
         0          0          0   -1516944  -15484238  -35222468  -55620370  -89116176 -125324586 -147563194 -160692551 -132899040  -20160918   80752492  112753194  107555236   97830005   92998908   79356672   64250540   49538442   32869212   17824442   16818008   14901991   10012626    5077917    1060800 
         0          0          0   -1194063  -11890242  -26226939  -38273879  -60269429  -91362459 -122546085 -147734226 -141961322  -56029858   54700357  106367676  108329308  104854551   93299051   75491439   63860119   47346558   26302016    7816653    4158219    2767362    1548768     646425          0 
         0          0          0    -298350   -5613621  -13365859  -19068183  -34537969  -61743409  -94259301 -117980676 -135980434 -104230821   -7915710   68410572   90320676  100124505   94852391   76915272   66382576   51575242   31129623   11611119    3672357          0          0          0          0 
         0          0          0          0   -1326000   -4155684   -5647213  -16193063  -38320709  -67131631  -88832005 -111707028 -125058611  -84469765   -8241422   45586382   88548155  102544719   88405185   79503102   65323069   46193993   24088751    9828975    1060800          0          0          0 
         0          0          0          0          0    -232050    -239343   -5994846  -21673331  -44510126  -65479082  -90131302 -118936207 -130498753  -94543716  -32279545   45283835  103259738  119556772  115645636   95935601   68779575   38704497   15961673    1390974          0          0          0 
         0          0          0          0          0          0          0   -2537301  -12254008  -31872362  -52941197  -78067597 -105963119 -133778149 -140191856 -107180157  -26713120   67273680  138941987  163941931  141629799   99476063   55751802   22743892    1739712          0          0          0 
         0          0          0          0          0          0    -397800   -2453763  -10689549  -28808026  -51035941  -76491269 -102742937 -130406357 -142451452 -130904021  -81667099   15552350  128751485  199745579  190191553  126997185   67991900   26768322    2049840          0          0          0 
         0          0          0          0    -381225   -1459926   -5394831  -11586315  -20870532  -37339930  -59140136  -82842746 -103913650 -125964067 -133319029 -122330315  -89406676   -1130030  122598934  210605434  213251947  143049705   74391198   28998190    2184000          0          0          0 
         0          0    -298350   -3120741   -7077525  -11994619  -19540239  -28625799  -39515939  -52362848  -67639028  -84258671 -100598254 -119164574 -122075324 -102676763  -53209585   26885488  129178552  210521540  206116507  136321345   72596085   28475642    2063100          0          0          0 
   -911625   -3726060   -7594002  -14525043  -21960135  -29296539  -38350109  -47801684  -56895362  -66016379  -76454143  -87447623  -96269170  -98616644  -80398583  -49231093    3425181   66667595  136139367  188457226  173642479  115988187   63866422   25548057    1759680          0          0          0 
  -3421080  -11222159  -20217947  -32320859  -43072664  -50797067  -58948718  -64281006  -68467104  -77380703  -87051063  -84576563  -67140179  -43665173  -15098347   14234819   58754780  102794906  134034652  139671796  119135919   86516060   50080887   21025949    1410864          0          0          0 
  -4343976  -14617688  -27374918  -44760308  -60462122  -71708370  -83660442  -87673096  -85050004  -88745912  -79938788  -48428712  -14426336   16593807   46926401   72055043   94883500  101998052  101718836   93883770   77004466   56995319   33620151   14408095    1103232          0          0          0 
  -5322720  -18425460  -36367020  -62562540  -86538180  -99036540 -111872530 -105024490  -79357264  -59030308  -34139144    2469950   40367747   71096981   86312519   85950017   85861870   81071776   73559804   62801654   48553229   33364799   18908539    7324161      33150          0          0          0 
  -6066450  -21436480  -44473780  -83517850 -119432170 -122162410 -106808284  -80831364  -47111631  -20005276    9055461   49040069   80059271   87982253   82854460   74820032   67788493   58774046   48875969   37694279   26564079   16626051    8694582    3016650          0          0          0          0 
  -6224400  -21952450  -45874270  -89116030 -122005828 -110313636  -82302498  -50835776  -14467781   11059955   39368831   66693451   73936671   74544831   69838064   60269144   49288439   37272149   26961159   17763219   10188763    4615143    1292850          0          0          0          0          0 
  -5701800  -19548120  -38633238  -65205156  -82550289  -76589364  -59262575  -34716629   -5653169   18736039   39440517   55853882   59809100   58499732   52452125   40291349   28395039   17856931   10329891    4788186    1374399      33150          0          0          0          0          0          0 
  -4773600  -15735812  -28976126  -44166119  -52900175  -50030861  -38680199  -20007615    2227671   21760221   35485018   44325596   44021921   38653979   30634139   20193635   11492143    4857801    1469208     149175          0          0          0          0          0          0          0          0 
  -3797001  -12099308  -20945462  -28422815  -31162643  -27169771  -18810903   -5779732    9359622   21122279   26119742   26921299   23777643   18599811   13079495    6645912    2379507     182325          0          0          0          0          0          0          0          0          0          0 


 9x9 Gy convolution image of image_#1
         0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0 
         0          0          0          0          0          0          0          0      49725     361998     759798    1251198    3608748    6656676   10926981   13380978   17834739   23495199   28783833   32187363   33129798   31363410   27961011   22631856   18674370   12835017    6788457    2105025 
         0          0          0          0     497250    1233180    3117426    6437574   10743330   17299191   24685239   32558139   42160641   51660729   61279727   66960872   74141383   81253227   85429930   85731163   82606889   75639167   64651697   50166360   37383099   23248010   11326913    3081624 
         0          0          0     812175    5461794   11778195   20611011   32143481   45365483   60595249   75951543   90809832  105467827  116691074  124820882  129057503  134067461  136304585  133113450  125721621  118513487  107934659   89401937   65825436   43795672   24504378   11029685    2702388 
         0          0          0    1078038    9279569   21191435   37754999   59436699   84311469  110506029  134673212  156183176  176177402  189388358  193039081  193638063  198425693  193173711  177944646  154118148  150713717  144050027  117981566   78815084   41532814   19693752    8122488    1839240 
         0          0          0     936156    9598008   24212346   45250097   78129473  118663109  156999579  189662721  216037126  235281883  248040908  242772223  231361999  213444021  188637037  157044151  130971962  117154673   97468962   68070300   39214200   18119490    7708740    2886780     499200 
         0          0          0     620880    7050240   19330162   39530973   81318112  139949185  180934448  202837522  214219560  216120700  206799976  185938083  162700514  126170391   84253490   37218342   15064430  -15199384  -42174132  -51319320  -36585120  -17230200   -7678320   -3306420    -990600 
         0          0          0     140400    2773680    8599428   17901832   43709933   87579365  116875408  124074850  122296432  109627670   79041038   39737186   12707831  -10176489  -43079178  -84188520 -101274630 -116412480 -118342710 -101881260  -66234510  -36924210  -18800730   -8235660   -2183220 
         0          0          0    -382200   -2279940   -5054880  -12540360  -23304807  -29208244  -22110481  -16774564   -1776616   -8037692  -41812712  -92635744 -120593919 -133448054 -137846891 -140676826 -135546310 -128170292 -113600492  -91461710  -63172332  -41453982  -23664920  -10932464   -2869464 
         0          0          0    -790140   -6579720  -16315662  -34349988  -64938326 -104530450 -122430893 -120801763  -98459534  -89398974 -114088921 -142229313 -159872538 -176040354 -175295568 -149622804 -129220029 -113582798  -96038711  -75056111  -55636200  -40083796  -24491781  -11822837   -3123393 
         0          0          0   -1018368   -9262346  -22714796  -43721792  -76745220 -118383420 -148505384 -154192623 -144784982 -121775032 -108963610 -103773860 -106246000 -114986409 -118366022  -97892926  -80596086  -67534458  -54950810  -39437858  -29223992  -20231731  -11598522   -5210517   -1060800 
         0          0          0   -1098591   -9927762  -23768559  -41882819  -68639009  -99921269 -125752947 -140934678 -147822970 -117007886  -61474773  -27472662  -16905292  -12515009  -10810079   -9282169   -9073977   -9756736   -9265282   -5038995   -5353257   -3581526   -1755624    -646425          0 
         0          0          0    -298350   -5284773  -13753051  -23827647  -41657359  -65434279  -88336553 -107848258 -127618440 -115240159  -47050166   28417604   65255758   75850003   69009377   57887922   42649518   28885056   18321441   11475867    3529149          0          0          0          0 
         0          0          0          0   -1326000   -4505748   -7530133  -17926595  -35752859  -55316413  -71916805  -90941254 -103689585  -65474219   20956636   89667946  125785133  129114033  111482535   84004864   59267331   39435407   22066775    8818563    1060800          0          0          0 
         0          0          0          0          0    -232050    -313599   -5302674  -18038495  -34246088  -49132544  -66029144  -84921109  -87881965  -44587510   29152545   96483259  144609238  147798766  117414468   82533883   54204281   28822863   11540165    1051518          0          0          0 
         0          0          0          0          0          0          0   -2478957  -10226554  -22025450  -31371605  -41373293  -54393251  -64395841  -61210730  -25357367   34530244  111671066  152952405  139940283   94861849   59473421   31480698   12420574     880464          0          0          0 
         0          0          0          0          0          0     397800    2216409    3399201    1672580    1419453    1766759     456313     903221    -588536     318853   18426083   67247042  104986561  110614219   77678451   44951837   22049830    8261844     525720          0          0          0 
         0          0          0          0     381225    1581918    5922579   13524771   24738900   35906812   47600828   59065916   67639244   74217175   78488553   74927411   58257404   38417502   30757304   26063718   16850351   10341709    5649576    2237820      15600          0          0          0 
         0          0     298350    3216213    8101197   15494791   27170799   43002549   63369469   86247812  108098366  127490653  142119886  148849580  139924370  109595555   60474145   -4957164  -43610838  -56655254  -46949353  -27111867  -12142275   -4280484    -499200          0          0          0 
    911625    4017780    9140118   18384483   30863901   46898319   67518029   91841714  117749732  143343969  168411565  188989031  193702414  168804272  118412551   50818895  -18379835  -84721475 -125935641 -124850122  -85186869  -51848909  -25936358   -9671529    -864240          0          0          0 
   3129360   11031215   22486835   39619979   60967344   85373673  113578296  141951056  168065270  188011409  201138835  191364963  152479035   85795237   10267589  -66470253 -128516984 -168404708 -174125056 -145297788  -95863657  -59806046  -31655103  -12681233   -1044888          0          0          0 
   2893332   10434056   22247846   40925576   66012264   95048570  127968904  162735942  180441882  176261546  147478814   95579676   27495868  -48728361 -119194321 -171946815 -192881658 -186185584 -155564772 -115885620  -79614580  -51216059  -27471375  -11236303   -1092624          0          0          0 
   2232360    8200080   18526500   37294470   68634090  104563770  127829340  132468600  116395302   78525114   19911892  -43368542 -109459571 -166313349 -197484483 -201465177 -179026090 -147778884 -116111898  -84900874  -56841329  -34505159  -17672707   -6369441     -33150          0          0          0 
   1060800    3776760    8794500   19482060   41767440   57962160   48968982   14467932  -29011407  -78459730 -125417999 -171766085 -199088569 -202572765 -186480592 -161517662 -133162737 -104667530  -77463149  -53388839  -33839019  -19272747   -9246198   -3016650          0          0          0          0 
   -429000   -2070900   -5740800  -15812760  -37373316  -69479482 -103629966 -137440800 -167784625 -192760667 -209965379 -213650839 -195147391 -164675953 -135979246 -107684150  -80901029  -56849299  -37331679  -22446459  -11859523   -5018247   -1292850          0          0          0          0          0 
  -1790100   -7179480  -17550126  -40757472  -83498553 -129519144 -164853347 -189658289 -201631499 -200855013 -192074809 -168171776 -139577232 -110615090  -83832871  -58910549  -38325069  -22697683  -12076623   -5196594   -1385007     -33150          0          0          0          0          0          0 
  -2678520  -10081544  -22403042  -43804019  -72336207 -101984025 -126891099 -143244341 -150079259 -145334357 -130580788 -109434420  -84555123  -61236889  -41289719  -24897461  -13092391   -5343117   -1516944    -149175          0          0          0          0          0          0          0          0 
  -3075657  -11049116  -22632338  -38034647  -55526277  -71971823  -85525147  -92912070  -93514158  -85504115  -71422460  -55494299  -39668157  -26101173  -15694523   -7412340   -2437851    -182325          0          0          0          0          0          0          0          0          0          0 



###     3. Sobel filter is a kind of linear differential operator.

# The operator uses two 3x3 kernels to calculate the discrete differential for horizontal change by Sobel_kernel_x as well as vertical change by Sobel_kernel_y. 
# In addition, it has a obvious and effective response on the edge of object.
# Therefore, we can use Sobel filter to implement edge detection.

# Note: we can take Sobel filter into formula to help us understand.
# 
#       I denotes the source image
#       * denotes the 2D-convolution here.
#  
#                                   ∂ I
#           I * Sobel_kernel_x = ----------
#                                   ∂ x
#
#
#                                   ∂ I
#           I * Sobel_kernel_y = ----------
#                                   ∂ y

'''